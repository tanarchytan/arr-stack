name: Deploy Media Stack

on:
  push:
    branches: [ "main" ]
    paths-ignore:
      - 'README.md'
      - 'docs/**'
      - 'infrastructure/**'
      - '.github/**'

jobs:
  update-production:
    runs-on: self-hosted
    steps:
      - name: Update Code and Deploy
        run: |
          echo "üöÄ Starting Deployment on TAN-ARR..."
          
          cd /opt/stacks || { echo "‚ùå Directory /opt/stacks not found"; exit 1; }
          
          git fetch origin main
          git reset --hard origin/main
          
          docker compose up -d --remove-orphans
          
          docker image prune -f
          
          echo "‚úÖ Deployment Complete"
